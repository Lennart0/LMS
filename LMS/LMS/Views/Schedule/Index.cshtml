@model IEnumerable<LMS.Models.Module>

@{
    ViewBag.Title = "Schedule";
}

<h2>Schema för @ViewBag.CourseName</h2>

<p>
    @*Html.ActionLink("Create New", "Create")*@
</p>
@foreach ( var item in Model ) {
    <span><a href="#@item.Id" >@item.Name</a> </span>
}
<table class="table">
    <!--tr>
        <th>
            @*Html.DisplayNameFor(model => model.Description)*@
        </th>
        <th>
            @*Html.DisplayNameFor(model => model.Name)*@
        </th>
        <th>
            @*Html.DisplayNameFor(model => model.Start)*@
        </th>
        <th>
            @*Html.DisplayNameFor(model => model.End)*@
        </th>
        <th></th>
    </tr-->

    @{DateTime today = DateTime.Now.Date;}
    @foreach ( var item in Model ) {
        
        <tr>
            <td colspan="2">
                <a id="@item.Id"></a>
                <span style="font-weight: bold">@Html.DisplayFor( modelItem => item.Name )</span>
            </td>
            <!--td>
                @*Html.DisplayFor( modelItem => item.Description )*@
            </td-->
            <td>

                @(item.Start.ToString("d MMMM") + " - " + item.End.ToString("d MMMM"))
                @*Html.DisplayFor( modelItem => item.Start )*@
            </td>
            <!--td>
                @*Html.DisplayFor( modelItem => item.End )*@
            </td-->
            <td>
                @*Html.ActionLink("Ändra", "Edit", new { id=item.Id }) |*@
                @Html.ActionLink( "Info", "Details", new { id = item.Id } )
                @*Html.ActionLink("Ta bort", "Delete", new { id=item.Id })*@
            </td>
        </tr>

        DateTime activityDate = new DateTime( 0 );
        foreach ( var activity in item.Activities.OrderBy(a=>a.Start) ) {
            if( activity.Start.Date != activityDate.Date ) {
                activityDate = activity.Start;
                <tr><td colspan="4" >  <!-- class="@**@(DateTime.Now.Date==activityDate.Date?"today":"")"  <span @**@(activityDate.Date==today?"style=\"font-weight: bold\"":"")> --> 
                        <span style="@(DateTime.Now.Date==activityDate.Date?"font-weight: bold":"")">@activity.Start.ToString( "dddd d MMMM" )</span>
                    @*Html.DisplayFor( x => activity.Start.Date )*@
                </td></tr>
            }
            <tr>
                <td>
                    @(activity.Start.ToString( "HH:mm" ) + " - " + activity.End.ToString( "HH:mm" ))
                    @*Html.DisplayFor( x => activity.Start.TimeOfDay )*@
                </td>
                <!--td>
                    @*Html.DisplayFor( x => activity.End.TimeOfDay )*@
                </td-->
                <td colspan="3">
                    @Html.DisplayFor( x => activity.Name )
                </td>
                <td>
                    @Html.ActionLink( "Info", "Details", "Activities", new { id = activity.Id }, null )
                </td>
            </tr>
            <tr>
                <td colspan="4">
                    @Html.DisplayFor( x => activity.Description )
                </td>
            </tr>
            if (activity.Documents.Where(d => d is LMS.Models.TimeSensetiveDocument).Count() > 0) {
                <tr><td>
    @Html.Partial( "~/Views/Shared/ModelFileView.cshtml",
    new LMS.Models.FileModalPartialViewModel {
        Id = activity.Id,
        Type = LMS.Models.DocumentTargetEntity.Activity,
        Title = "Lösning på inlämningsuppgift",
        PostBackChange = "location.reload()"
    } )
                </td></tr>
            }
            /*
            foreach ( var doc in activity.Documents.Where(d => !string.IsNullOrWhiteSpace(d.Url)).ToList() ) {
                <tr>
                    <td colspan="4"><a href="@doc.Url" target="_blank">@doc.Url</a></td>
                </tr>
            }
            */
        }
    }
    <tr><td></td></tr>
</table>

